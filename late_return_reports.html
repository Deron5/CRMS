<!DOCTYPE html>
<html lang="en">

<head>
    <title>CRMS</title>
    <link rel="stylesheet" href="tailwind.css">
    <link rel="stylesheet" href="main.css">

</head>

<body class="" onload="init()">

    <div class="h-screen grid grid-rows-1 main border-2 border-stone-100">
        <details open class="sidebar h-full relative p-2 border-r-2 border-indigo-200">
            <summary class="list-none min-w-[5.75rem] mb-5 text-violet-500 text-3xl pb-4  border-[#767b99] border-b-2">
                CRMS
            </summary>
            <div class="flex flex-col w-40 gap-6">
                <button class="bg-violet-400 hover:bg-[#8e72e1] text-white font-bold py-2 px-4 border border-slate-200 rounded relative" onclick="window.location.href='http://localhost:8080/index.html'">Home Page
                    <div class="absolute right-0 top-[.45rem]">
                        <svg viewBox="0 0 24 24" focusable="false" height="28" width="28" class="t0PEec">
                            <path d="M0 0h24v24H0z" fill="none"></path>
                            <path fill="white" d="M8.59,16.59L13.17,12L8.59,7.41L10,6l6,6l-6,6L8.59,16.59z"></path>
                        </svg>
                    </div>
                </button>
                <button class="bg-violet-400 hover:bg-[#8e72e1] text-white font-bold py-2 px-4 border border-slate-200 rounded relative" onclick="window.location.href='http://localhost:8080/customers.html'">Customer Page
                    <div class="absolute right-0 top-[.45rem]">
                        <svg viewBox="0 0 24 24" focusable="false" height="28" width="28" class="t0PEec">
                            <path d="M0 0h24v24H0z" fill="none"></path>
                            <path fill="white" d="M8.59,16.59L13.17,12L8.59,7.41L10,6l6,6l-6,6L8.59,16.59z"></path>
                        </svg>
                    </div>
                </button>

                <button class="bg-violet-400 hover:bg-[#8e72e1] text-white font-bold py-2 px-4 border border-slate-200 rounded relative" onclick="window.location.href='http://localhost:8080/vehicles.html'">Vehicles Page
                    <div class="absolute right-0 top-[.45rem]">
                        <svg viewBox="0 0 24 24" focusable="false" height="28" width="28" class="t0PEec">
                            <path d="M0 0h24v24H0z" fill="none"></path>
                            <path fill="white" d="M8.59,16.59L13.17,12L8.59,7.41L10,6l6,6l-6,6L8.59,16.59z"></path>
                        </svg>
                    </div>
                </button>
                <button class="bg-violet-400 hover:bg-[#8e72e1] text-white font-bold py-2 px-4 border border-slate-200 rounded relative" onclick="window.location.href='http://localhost:8080/rentals.html'">Rentals Page

                    <div class="absolute right-0 top-[.45rem]">
                        <svg viewBox="0 0 24 24" focusable="false" height="28" width="28" class="t0PEec">
                            <path d="M0 0h24v24H0z" fill="none"></path>
                            <path fill="white" d="M8.59,16.59L13.17,12L8.59,7.41L10,6l6,6l-6,6L8.59,16.59z"></path>
                        </svg>
                    </div>
                </button>

                <details open class="leftArw opts">
                    <summary class="bg-violet-400 hover:bg-[#8e72e1] text-white font-bold py-2 px-4 border border-b-0 border-slate-300 rounded list-none text-center">
                        Reports</summary>
                    <div class="flex flex-col bg-[#f2f2f8]">
                        <button class=" p-2 bg-[#fbfcff] text-gray-700 text-[15px] font-medium hover:bg-[#a78bfa9c] border-2 relative" onclick="window.location.href='http://localhost:8080/rentals_reports'">
                            Vehicle Rentals
                            <div class="absolute right-[-5px] top-[.35rem]">
                                <svg viewBox="0 0 24 24" focusable="false" height="28" width="28" class="t0PEec">
                                    <path d="M0 0h24v24H0z" fill="none"></path>
                                    <path fill="#404355" d="M8.59,16.59L13.17,12L8.59,7.41L10,6l6,6l-6,6L8.59,16.59z">
                                    </path>
                                </svg>
                            </div>
                        </button>
                        <button class=" p-2 bg-[#fbfcff] text-gray-700 text-[15px] font-medium hover:bg-[#a78bfa9c] border-2 border-t-0 relative" onclick="window.location.href='http://localhost:8080/customer_reports'">
                            Customer Rentals
                            <div class="absolute right-[-5px] top-[.35rem]">
                                <svg viewBox="0 0 24 24" focusable="false" height="28" width="28" class="t0PEec">
                                    <path d="M0 0h24v24H0z" fill="none"></path>
                                    <path fill="#404355" d="M8.59,16.59L13.17,12L8.59,7.41L10,6l6,6l-6,6L8.59,16.59z">
                                    </path>
                                </svg>
                            </div>
                        </button>
                        <button class=" p-2 bg-[#fbfcff] text-gray-700 text-[15px] font-medium hover:bg-[#a78bfa9c] border-2 border-t-0 relative" onclick="window.location.href='http://localhost:8080/rentals_reports'">
                            Rental History
                            <div class="absolute right-[-5px] top-[.35rem]">
                                <svg viewBox="0 0 24 24" focusable="false" height="28" width="28" class="t0PEec">
                                    <path d="M0 0h24v24H0z" fill="none"></path>
                                    <path fill="#404355" d="M8.59,16.59L13.17,12L8.59,7.41L10,6l6,6l-6,6L8.59,16.59z">
                                    </path>
                                </svg>
                            </div>
                        </button>
                        <button class=" p-2 bg-[#fbfcff] text-gray-700 text-[15px] font-medium hover:bg-[#a78bfa9c] border-2 border-t-0 relative" onclick="window.location.href='http://localhost:8080/availability_reports'">
                            Vehicle Availability
                            <div class="absolute right-[-5px] top-[.35rem]">
                                <svg viewBox="0 0 24 24" focusable="false" height="28" width="28" class="t0PEec">
                                    <path d="M0 0h24v24H0z" fill="none"></path>
                                    <path fill="#404355" d="M8.59,16.59L13.17,12L8.59,7.41L10,6l6,6l-6,6L8.59,16.59z">
                                    </path>
                                </svg>
                            </div>
                        </button>
                        <button class=" p-2 bg-[#fbfcff] text-gray-700 text-[15px] font-medium hover:bg-[#a78bfa9c] border-2 border-t-0 relative" onclick="window.location.href='http://localhost:8080/late_return_reports'">
                            Late Returns
                            <div class="absolute right-[-5px] top-[.35rem]">
                                <svg viewBox="0 0 24 24" focusable="false" height="28" width="28" class="t0PEec">
                                    <path d="M0 0h24v24H0z" fill="none"></path>
                                    <path fill="#404355" d="M8.59,16.59L13.17,12L8.59,7.41L10,6l6,6l-6,6L8.59,16.59z">
                                    </path>
                                </svg>
                            </div>
                        </button>
                        <button class=" p-2 bg-[#fbfcff] text-[#404355] text-[15px]  font-medium hover:bg-[#a78bfa9c]  border-2 border-t-0 relative" onclick="window.location.href='http://localhost:8080/turnover_reports'">
                            Vehicle Turnover
                            <div class="absolute right-[-5px] top-[.35rem]">
                                <svg viewBox="0 0 24 24" focusable="false" height="28" width="28" class="t0PEec">
                                    <path d="M0 0h24v24H0z" fill="none"></path>
                                    <path fill="#404355" d="M8.59,16.59L13.17,12L8.59,7.41L10,6l6,6l-6,6L8.59,16.59z">
                                    </path>
                                </svg>
                            </div>
                        </button>
                    </div>
                </details>



            </div>
        </details>
        <div class="bg-white w-full h-full PageContents">
            <div id="title" class="flex items-center justify-center h-24 text-4xl text bg-[#f2f2f8]">
                Late Return Reports
            </div>
            <div class="bg-slate-50 relative" id="table" style="grid-template-columns:repeat(2,minmax(max-content,auto))">
                <details open class="relative border-x-2 border-y-2">
                    <summary class="hover:bg-[#f7f4f8]">
                        Customer Details
                    </summary>
                    <div>
                        <table class="w-full">
                            <thead style="color: #a78bfa;">
                                <tr>
                                    <th>Customer Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Drivers License</th>
                                    <th class="border-r-0">Address</th>
                                </tr>
                            </thead>
                            <tbody id="cDetails">

                            </tbody>
                        </table>
                    </div>
                </details>

                <details class="border-y-2 border-r-2">
                    <summary class="hover:bg-[#f7f4f8]">Rental Details</summary>
                    <div>
                        <table class="w-full">
                            <thead>
                                <tr>
                                    <th>Vehicle License Plate</th>
                                    <th>lend Date</th>
                                    <th>Return Date</th>
                                    <th>Returned Date</th>
                                    <th>Lend Condition</th>
                                    <th>Return Condition</th>
                                    <th>Extra Charges</th>
                                    <th>Rental Rate</th>
                                    <th class="border-r-0">Rental Fee</th>
                                </tr>
                            </thead>
                            <tbody id="vDetails">

                            </tbody>
                        </table>
                    </div>
                </details>
            </div>
        </div>
    </div>



    <script>
        function init() {
            fetch('rentals', {
                method: 'POST',
                body: JSON.stringify({ func: "LateReturns", params: { null: null } }),
            }).then((res) => res.json())
                .then((results) => loadData(results))

        }


        function loadData(results) {
            console.log(results);
            let vd = document.querySelector("#vDetails");
            let cd = document.querySelector("#cDetails");
            let today = new Date()
            results.forEach(dataset => {
                color = undefined;

                let rd = new Date(dataset.return_date);
                if (dataset.returned_date == "null" || !dataset.returned_date) {
                    if (rd < today) {
                        color = `style="color:rgb(244 63 94)"`
                        dataset.returned_date = "Overdue"

                    } else if (new Date(dataset.lend_date) > today) {
                        color = `style="color:rgb(52 211 153)"`
                        dataset.returned_date = "Future Rental"
                    } else {
                        color = `style="color:rgb(52 211 153)"`
                        dataset.returned_date = "Ongoing"
                    }

                } else if (rd < new Date(dataset.returned_date)) {
                    color = `style="color:rgb(244 63 94)"`
                }

                vd.innerHTML += `
                    <tr>
                        <td>${dataset.vehicle_id}</td>
                        <td>${dataset.lend_date}</td>
                        <td>${dataset.return_date}</td>
                        <td ${color}>${dataset.returned_date}</td>
                        <td>${dataset.lent_condition}</td>
                        <td>${dataset.return_condition}</td>
                        <td>${dataset.extra_charges}</td>
                        <td>${dataset.rental_rate}</td>
                        <td>${dataset.rental_fee}</td>
                    </tr>
                `

                cd.innerHTML += `
                <td>${dataset.first_name} ${dataset.surname}</td>
                        <td>${dataset.email}</td>
                        <td>${dataset.drivers_license}</td>
                        <td>${dataset.phone_number}</td>
                        <td>${dataset.address}</td>
                `

            });
        }
    </script>

</body>

</html>